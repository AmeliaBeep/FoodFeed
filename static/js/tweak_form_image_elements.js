/**
 * Updates the form content generated by Django to add a
 * current image and remove image checkbox.
 * 
 * The current image URL is sourced from the hyperlink tag
 * and then this script makes an image.
 * 
 * When the user has no profile image set, the generated 
 * URL is invalid, so instead the image is sourced from the
 * no-user-image resource on Cloudinary.
 * 
 * The form section for allowing file input is edited 
 * to add an additional input which sets whether the current 
 * image should be removed. 
 */
let currentImage = document.querySelector("#div_id_image div div");
let imageLink = currentImage.querySelector("a");
let profilePictureUploadInput = document.querySelector("#id_image");
let profilePictureUploadDiv = profilePictureUploadInput.parentElement;

currentImage.innerHTML = `
<div class="mx-auto" style="max-width:50%; aspect-ratio: 1 / 1;">
    <img class="profile-image-square" src="${imageLink?.href || ''}" 
        style="border: 1px solid black" 
        onerror="this.src='https://res.cloudinary.com/ds7qeovpw/image/upload/v1762460798/no-user-image.jpg'">
</div>`;

profilePictureUploadDiv.innerHTML = `
<div class="row"> 
    <div class="col-md-8 mb-2">
        <input type="file" name="image" class="form-control" id="id_image">
    </div>

    <div class="col-md-4">
        <div class="input-group">
            <span class="input-group-text">Remove?</span>
            <div class="form-control text-end">
                <input class="form-check-input" type="checkbox" name="delete_image_toggle" id="delete_image_toggle" value="True">
            </div>
        </div>
        <label for="delete_image_toggle"></label>
    </div>
</div>`;